@model IndexViewModel
@using X.PagedList.Mvc.Core

@{
    var rqf = Context.Features.Get<IRequestCultureFeature>();
    var currentCulture = rqf.RequestCulture.Culture.Name;
}

<!-- table CustomerView-->
<div class="card rounded-3 p-1 overflow-auto">
    <table class="table table-sm table-striped table-hover table-bordered m-0 ">

        <thead>
            <tr>
                <th colspan="4" class="text-uppercase text-center">@Model.Localizer["tableC.headerCustomers"]</th>
                @if (User.IsInRole("AssistantCommercial"))
                {
                    <th colspan="2" class="text-uppercase text-center">@Model.Localizer["tableC.headerSalespeople"]</th>
                }
             
            </tr>
            <tr class="align-middle">
                <th id="sortCustomerName" scope="col" customer-sort="@ViewBag.NameSortParm" class="pointer-cursor" style="min-width: 150px;">
                    <div class="row">
                        <div class="col-6 d-flex align-items-center customersList">
                            @Model.Localizer["tableC.headerName"]
                        </div>
                        <div class="col-6 d-flex flex-column align-items-end">
                            <i class="fa-solid fa-arrow-up-z-a" id="customerNDesc" @if (ViewBag.SortType == "Name"){<text>active-sort='true'</text>}></i>
                            <i class="fa-solid fa-arrow-down-a-z" id="customerNAsc" @if (ViewBag.SortType == "Name_desc"){<text>active-sort='true'</text>}></i>
                        </div>

                    </div>
                </th>
                <th id="sortCustomerCode" scope="col" customer-sort="@ViewBag.CodeSAPSortParm" class="pointer-cursor" style="min-width: 100px;">
                    <div class="row">
                        <div class="col-6 d-flex align-items-center codeCliList">
                            @Model.Localizer["tableC.headerCode"]
                        </div>
                        <div class="col-6 d-flex flex-column align-items-end">
                            <i class="fa-solid fa-arrow-up-9-1" id="codeSAPDesc"  @if (ViewBag.SortType == "CodeSAP"){<text>active-sort='true'</text>}></i>
                            <i class="fa-solid fa-arrow-down-1-9" id="codeSAPAsc" @if (ViewBag.SortType == "CodeSAP_desc"){<text>active-sort='true'</text>}></i>
                        </div>
                    </div>
                </th>

                <th scope="col" style="text-align:center !important">@Model.Localizer["tableC.headerStatus"]</th>
                <th id="sortLastUpdate" scope="col" customer-sort="@ViewBag.LastUpdateSortParm" class="pointer-cursor" style="min-width: 100px;">
                    <div class="row">
                        <div class="col-6 d-flex align-items-center">
                            @Model.Localizer["tableP.headerLastUpdate"]
                        </div>
                        <div class="col-6 d-flex flex-column align-items-end">
                            <i class="fa-solid fa-arrow-up-9-1" id="lastUpdateDesc" @if (ViewBag.SortType == ""){<text>active-sort='true'</text>}></i>
                            <i class="fa-solid fa-arrow-down-1-9" id="lastUpdateAsc" @if (ViewBag.SortType == "LastUpdate_desc"){<text>active-sort='true'</text>}></i>
                        </div>
                    </div>
                </th>
                @if (User.IsInRole("AssistantCommercial"))
                {
                    <th>@Model.Localizer["tableC.headerSalespersonName"]</th>
                }
               

            </tr>
            <tr>
                <th><input type="text" class="form-control" placeholder="@Model.Localizer["search.byName"]" id="customerSearchName" asp-for="SearchedName" /></th>
                <th><input type="text" class="form-control" placeholder="@Model.Localizer["search.byCode"]" id="customerSearchCode" asp-for="SearchedCode" /></th>

                <input type="text" id="focusedElement" asp-for= "FocusedInputElement" hidden/>
                <th>
                    <select class="form-select col-4 pointer-cursor" aria-label="Default select example" id="entryStatus" asp-items="@Model.Statuses" asp-for="SelectedStatus">
                        <option selected="selected" value="4">@Model.Localizer["tableC.headerSortStatus"]</option>
                    </select>
                </th>
                <th></th>
                @if (User.IsInRole("AssistantCommercial"))
                {
                    <th>
                        <select class="form-select col-4" aria-label="Default select example" id="entryCommercial" asp-items="@Model.Commerciaux" asp-for="SelectedCommercial">
                            <option value="1">@Model.Localizer["tableC.allSalespeople"]</option>
                        </select>
                    </th>
                }
      

            </tr>
        </thead>

        <tbody>
            @if (Model.Customers.Count() == 0 && (Model.SelectedStatus != 4 || Model.CustomerFound == false))
            {
                <tr><th scope="row" colspan="4"> @Model.Localizer["page.noResults"]</th></tr>
            }
            else
            {

                @foreach (var customer in Model.Customers)
                {

                    <tr class="customerLine align-middle pointer-cursor" target-customer="@customer.CodeSAP" target-commercial="@customer.IdCommercial" target-url="@Url.Action("CustomersProducts", "ForecastEntry", new { idCustomer = customer.IdClient, idCommercial = customer.IdCommercial})">
                        <td class="customerName">@customer.Libelle</td>
                        <td>@customer.CodeSAP</td>
                        <td>
                            <div class="style-status-general @if(customer.Statut.Split('_')[1] == "1") {<text>style-status-new</text>} else if(customer.Statut.Split('_')[1] == "2") {<text>style-status-make</text>} else {<text>style-status-made</text>}">
                                @customer.Statut.Split('_')[0]   @if (customer.Statut.Split('_')[1] == "1")
                                {
                                    <text></text>
                                }
                                else if (customer.Statut.Split('_')[1] == "2")
                                {
                                    <text></text>
                                }
                                else
                                {
                                    <text></text>
                                }
                            </div>
                        </td>
                        <td>
                            @if (customer.DateModification == null)
                            {
                                <text>@Model.Localizer["tableRow.Noforecasts"]</text>
                            }
                            else
                            {
                                @customer.DateModification?.ToString(Model.DateFormatSelected) @if (customer.NbJours == 0)
                                {
                                    <text>, @Model.Localizer["tableC.today"]</text>
                                }
                                else
                                {
                                    
                                        <text>, </text> @customer.NbJours <text> @Model.Localizer["tableC.daysAgo"]</text>
                               
                                }
                            }
                        </td>
                        @if (User.IsInRole("AssistantCommercial"))
                        {
                            <td>@customer.NomCommercial - @customer.CodeSAPCommercial</td>
                        }
                       
                    </tr>
                }}
        </tbody>
    </table>

    <!-- Pagination-->
    <div class="row m-3 p-container d-flex justify-content-between">
        <div class="col-3 text-start d-none d-md-block">
            @if (Model.Customers.Count() == 10)
            {
                <span class="fw-bold">@Model.Localizer["pagination.nbCustomers"] :  @(Model.Customers.Count * Model.Customers.PageNumber) / @Model.CustomersListTotal.Count</span>
            }
            else
            {
                <span class="fw-bold">@Model.Localizer["pagination.nbCustomers"] :  @Model.CustomersListTotal.Count / @Model.CustomersListTotal.Count</span>
            }
        </div>

        <div class="col-12 col-md-5 d-flex justify-content-center mt-2 mt-md-0">
            <div class="pagination-container">
                @if (Model.Customers.PageNumber != 1 && Model.Customers.PageNumber != 2)
                {
                    <div> <a id="page_1" class="pagination btn-link d-flex align-items-center justify-content-center fw-bold" target-page="1">1</a></div>
                    <span class="align-self-end fw-bold fs-5">...</span>
                }

                @if (Model.Customers.HasPreviousPage)
                {
                    <div>
                        <a id="page_@(Model.Customers.PageNumber-1)" class="pagination btn-link d-flex align-items-center justify-content-center fw-bold" target-page="@(Model.Customers.PageNumber-1)">@(Model.Customers.PageNumber - 1)</a>
                    </div>
                }
                <div class="active">
                    <a id="page_@Model.Customers.PageNumber" class="pagination btn-link d-flex align-items-center justify-content-center fw-bold" target-page="@Model.Customers.PageNumber">@Model.Customers.PageNumber</a>
                </div>

                @if (Model.Customers.HasNextPage)
                {
                    <div>
                        <a id="page_@(Model.Customers.PageNumber+1)" class="pagination btn-link d-flex align-items-center justify-content-center fw-bold" target-page="@(Model.Customers.PageNumber+1)">@(Model.Customers.PageNumber + 1)</a>
                    </div>
                }

                @if (Model.Customers.PageNumber != Model.Customers.PageCount && Model.Customers.PageNumber != Model.Customers.PageCount - 1 && Model.Customers.PageCount != 0)
                {
                    <span class="align-self-end fw-bold fs-5">...</span>
                    <div>
                        <a id="page_@Model.Customers.PageCount" class="pagination btn-link d-flex align-items-center justify-content-center fw-bold" target-page="@Model.Customers.PageCount">@Model.Customers.PageCount</a>
                    </div>
                }
            </div>
        </div>

        <div class="col-2 text-end fw-bold d-none d-md-block">
            @Model.Localizer["pagination.page"] @(Model.Customers.PageCount < Model.Customers.PageNumber ? 0 : Model.Customers.PageNumber) / @Model.Customers.PageCount
        </div>
    </div>



